{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}Update Profile — PharmaCare{% endblock %}

{% block content %}
<div class="min-vh-100 d-flex align-items-center justify-content-center py-5"
     style="background: linear-gradient(135deg, #f5fffd 0%, #e8f7f5 100%);">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-8 col-xl-8">

        <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
          <!-- Header -->
          <div class="text-white text-center py-5 px-4"
               style="background: linear-gradient(135deg, var(--pharma-teal), var(--pharma-teal-dark));">
            <i class="bi bi-person-gear fs-1 mb-3 d-block opacity-100"></i>
            <h2 class="fw-bold mb-2 text-white">Update Profile</h2>
            <p class="mb-0 opacity-100">Keep your information current and secure</p>
          </div>

          <div class="card-body p-5">

            <!-- Success/Error Messages -->
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show rounded-3 mb-4">
                  <i class="bi {% if message.tags == 'success' %}bi-check-circle-fill
                              {% elif message.tags == 'error' %}bi-exclamation-triangle-fill
                              {% else %}bi-info-circle-fill{% endif %} me-2"></i>
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}

            <form method="POST" novalidate>
              {% csrf_token %}

              <!-- Personal Information Section -->
              <h5 class="fw-bold text-primary mb-4 d-flex align-items-center gap-2">
                <i class="bi bi-person-badge"></i> Personal Information
              </h5>

              <div class="row g-4 mb-5">
                <div class="col-md-6">
                  <label class="form-label fw-semibold d-flex align-items-center gap-2">
                    <i class="bi bi-person text-primary"></i> First Name
                  </label>
                  {{ form.first_name|add_class:"form-control form-control-lg rounded-3 shadow-sm"|attr:"placeholder:John" }}
                  {% for error in form.first_name.errors %}
                    <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                  {% endfor %}
                </div>

                <div class="col-md-6">
                  <label class="form-label fw-semibold d-flex align-items-center gap-2">
                    <i class="bi bi-person-fill text-primary"></i> Last Name
                  </label>
                  {{ form.last_name|add_class:"form-control form-control-lg rounded-3 shadow-sm"|attr:"placeholder:Doe" }}
                  {% for error in form.last_name.errors %}
                    <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                  {% endfor %}
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold d-flex align-items-center gap-2">
                    <i class="bi bi-envelope-fill text-primary"></i> Email Address
                  </label>
                  {{ form.email|add_class:"form-control form-control-lg rounded-3 shadow-sm"|attr:"placeholder:you@example.com" }}
                  {% for error in form.email.errors %}
                    <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                  {% endfor %}
                </div>

                <div class="col-md-6">
                  <label class="form-label fw-semibold d-flex align-items-center gap-2">
                    <i class="bi bi-telephone-fill text-primary"></i> Phone Number
                  </label>
                  {{ form.phone|add_class:"form-control form-control-lg rounded-3 shadow-sm"|attr:"placeholder:+91 98765 43210" }}
                  {% for error in form.phone.errors %}
                    <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                  {% endfor %}
                </div>

                {% if user.role == "pharmacist" %}
                <div class="col-md-6">
                  <label class="form-label fw-semibold d-flex align-items-center gap-2">
                    <i class="bi bi-hospital-fill text-primary"></i> Pharmacy Name
                  </label>
                  {{ form.pharmacy_name|add_class:"form-control form-control-lg rounded-3 shadow-sm"|attr:"placeholder:CityCare Pharmacy" }}
                  <small class="text-muted d-block mt-1">Visible to patients</small>
                  {% for error in form.pharmacy_name.errors %}
                    <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                  {% endfor %}
                </div>
                {% else %}
                  {{ form.pharmacy_name }} {# Hidden for non-pharmacists #}
                {% endif %}

                <div class="col-12">
                  <label class="form-label fw-semibold d-flex align-items-center gap-2">
                    <i class="bi bi-geo-alt-fill text-primary"></i> Full Address
                  </label>
                  {{ form.address|add_class:"form-control form-control-lg rounded-3 shadow-sm"|attr:"rows:5"|attr:"placeholder:123 Main Road, Near City Hospital, Mumbai - 400001" }}
                  {% for error in form.address.errors %}
                    <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                  {% endfor %}
                </div>
              </div>

              <!-- Password Change Section (Optional) -->
              <hr class="my-5 border-secondary-subtle">

              <h5 class="fw-bold text-primary mb-4 d-flex align-items-center gap-2">
                <i class="bi bi-shield-lock-fill"></i> Change Password <small class="text-muted fw-normal">(Optional)</small>
              </h5>

              <div class="bg-light rounded-4 p-4 border-start border-warning border-4 mb-5">
                <div class="row g-4">
                  <div class="col-md-6">
                    <label class="form-label fw-medium">New Password</label>
                    {{ form.new_password1 }}
                    <small class="text-muted d-block mt-1">
                      
                    </small>
                    {% for error in form.new_password1.errors %}
                      <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                    {% endfor %}
                  </div>

                  <div class="col-md-6">
                    <label class="form-label fw-medium">Confirm Password</label>
                    {{ form.new_password2 }}
                    {% for error in form.new_password2.errors %}
                      <small class="text-danger d-block mt-1"><i class="bi bi-exclamation-circle-fill me-1"></i>{{ error }}</small>
                    {% endfor %}
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-flex flex-column flex-md-row gap-3 justify-content-between">
                <a href="{% url 'profile' %}"
                   class="btn btn-outline-secondary btn-lg rounded-3 px-5 d-flex align-items-center justify-content-center gap-2">
                  <i class="bi bi-arrow-left-circle"></i> Cancel
                </a>

                <button type="submit"
                        class="btn btn-primary btn-lg rounded-3 px-5 fw-bold d-flex align-items-center justify-content-center gap-2 shadow-sm">
                  <i class="bi bi-check-circle-fill"></i>
                  Save All Changes
                </button>
              </div>
            </form>
          </div>
        </div>

        <div class="text-center mt-4 text-muted small">
          <i class="bi bi-shield-check-fill text-success me-1"></i>
          Your data is encrypted • Secure & private
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .form-control:focus, .form-select:focus {
    border-color: var(--pharma-teal) !important;
    box-shadow: 0 0 0 0.25rem rgba(43, 138, 126, 0.15) !important;
  }
  .btn:hover {
    transform: translateY(-3px);
    transition: all 0.3s ease;
  }
</style>
{% endblock %}